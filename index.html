<!DOCTYPE html><html class="default"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>fast-ternary-string-set</title><meta name="description" content="Documentation for fast-ternary-string-set"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script async src="assets/search.js" id="search-script"></script></head><body><script>document.body.classList.add(localStorage.getItem("tsd-theme") || "os")</script><header><div class="tsd-page-toolbar"><div class="container"><div class="table-wrap"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget search no-caption">Search</label><input type="text" id="tsd-search-field"/></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">fast-ternary-string-set</a></div><div class="table-cell" id="tsd-widgets"><div id="tsd-filter"><a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a><div class="tsd-filter-group"><div class="tsd-select" id="tsd-filter-visibility"><span class="tsd-select-label">All</span><ul class="tsd-select-list"><li data-value="public">Public</li><li data-value="protected">Public/Protected</li><li data-value="private" class="selected">All</li></ul></div> <input type="checkbox" id="tsd-filter-inherited" checked/><label class="tsd-widget" for="tsd-filter-inherited">Inherited</label><input type="checkbox" id="tsd-filter-externals" checked/><label class="tsd-widget" for="tsd-filter-externals">Externals</label></div></div><a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a></div></div></div></div><div class="tsd-page-title"><div class="container"><h1>fast-ternary-string-set</h1></div></div></header><div class="container container-main"><div class="row"><div class="col-8 col-content"><div class="tsd-panel tsd-typography">
<a href="#fast-ternary-string-set" id="fast-ternary-string-set" style="color: inherit; text-decoration: none;">
  <h1>Fast ternary string set</h1>
</a>
<p><img src="https://github.com/CGJennings/fast-ternary-string-set/actions/workflows/ci.yml/badge.svg" alt="CI status badge"></p>
<p>A fast, space-efficient, serializable string set based on <a href="#about-ternary-search-trees"><em>ternary search trees</em></a> (or <em>lexicographic trees</em>), with both exact and approximate search.</p>
<p><strong>Common applications:</strong> autocompletion, text prediction, spelling checking, word games and puzzles</p>
<p><strong>Jump to:</strong> <a href="#features">Features</a>&nbsp;/ <a href="#installation">Installation</a>&nbsp;/ <a href="#examples">Examples</a>&nbsp;/ <a href="#usage-notes">Usage notes</a>&nbsp;/ <a href="#serialization-format">Serialization format</a>&nbsp;/ <a href="https://cgjennings.github.io/fast-ternary-string-set/classes/TernaryStringSet.html">API docs</a></p>

<a href="#features" id="features" style="color: inherit; text-decoration: none;">
  <h2>Features</h2>
</a>
<ul>
<li>Drop-in replacement for <a href="#differences-from-standard-js-set">nearly any use</a> of a <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Set">JavaScript <code>Set</code></a> of strings.</li>
<li>Serializes to an <code>ArrayBuffer</code>: load sets directly without the overhead of initializing from a list of strings.</li>
<li>Search and iteration methods return elements in ascending sorted order (lexicographic by code point).</li>
<li>Set relations (equal, subset, superset, disjoint).</li>
<li>Set operations (union, intersection, difference, symmetric difference).</li>
<li><code>Array</code>-like functional methods (forEach, filter, map, find, reduce, join, some, every).</li>
<li>Several approximate matching methods:<ol>
<li>List strings that complete a prefix.</li>
<li>List strings that are completed by a suffix.</li>
<li>List strings that can be made from a list of letters.</li>
<li>List strings within a certain <a href="https://en.wikipedia.org/wiki/Hamming_distance">Hamming distance</a> of a pattern.</li>
<li>List strings within a certain <a href="https://en.wikipedia.org/wiki/Levenshtein_distance">edit distance</a> of a pattern.</li>
<li>List strings that match a pattern including &quot;don&#39;t care&quot; letters (as <code>.</code> in a regular expression).</li>
<li>List strings that exactly match a regular expression.</li>
<li>List strings that match an arbitrary test.</li>
</ol>
</li>
<li>Time and space efficient:<ul>
<li>Leverages common JS engine optimizations under the hood.</li>
<li>Elements share tree nodes and do not retain references to the original strings.</li>
<li>Read-only sets can be <a href="https://cgjennings.github.io/fast-ternary-string-set/classes/TernaryStringSet.html#compact"><em>compacted</em></a> to save even more space.</li>
</ul>
</li>
<li>Well-documented TypeScript source, targeting modern JavaScript by default.</li>
<li>Use as a standalone/ECMAScript module or as a Node.js/CommonJS module.</li>
<li>Operates on full code points rather than 16-bit characters.</li>
<li>Backed by extensive test suites.</li>
<li>No other dependencies.</li>
</ul>

<a href="#installation" id="installation" style="color: inherit; text-decoration: none;">
  <h2>Installation</h2>
</a>
<p>To install the latest stable version with <code>npm</code>:</p>
<pre><code class="language-bash"><span class="hl-0">npm install fast-ternary-string-set</span>
</code></pre>
<p>Or, if using <code>yarn</code>:</p>
<pre><code class="language-bash"><span class="hl-0">yarn add fast-ternary-string-set</span>
</code></pre>
<p>To use it without Node.js, you can simply copy the main source file (<code>src/index.ts</code>) into any TypeScript project, rename to something sensible, and then <code>import</code> it into your code as usual.</p>

<a href="#examples" id="examples" style="color: inherit; text-decoration: none;">
  <h2>Examples</h2>
</a>
<p><a href="https://cgjennings.github.io/fast-ternary-string-set/classes/TernaryStringSet.html">Complete API docs are available.</a> Here are some examples to get you started:</p>
<p>Loading the module:</p>
<pre><code class="language-js"><span class="hl-1">// From Node.js with CommonJS-style modules:</span><br/><span class="hl-2">const</span><span class="hl-0"> { </span><span class="hl-3">TernaryStringSet</span><span class="hl-0"> } = </span><span class="hl-4">require</span><span class="hl-0">(</span><span class="hl-5">&quot;fast-ternary-string-set&quot;</span><span class="hl-0">);</span><br/><span class="hl-1">// From TypeScript:</span><br/><span class="hl-6">import</span><span class="hl-0"> { </span><span class="hl-7">TernaryStringSet</span><span class="hl-0"> } </span><span class="hl-6">from</span><span class="hl-0"> </span><span class="hl-5">&quot;fast-ternary-string-set&quot;</span><span class="hl-0">;</span>
</code></pre>
<p>Create a new set and add some strings:</p>
<pre><code class="language-js"><span class="hl-2">const</span><span class="hl-0"> </span><span class="hl-3">set</span><span class="hl-0"> = </span><span class="hl-2">new</span><span class="hl-0"> </span><span class="hl-4">TernaryStringSet</span><span class="hl-0">();</span><br/><span class="hl-7">set</span><span class="hl-0">.</span><span class="hl-4">add</span><span class="hl-0">(</span><span class="hl-5">&quot;dog&quot;</span><span class="hl-0">).</span><span class="hl-4">add</span><span class="hl-0">(</span><span class="hl-5">&quot;cat&quot;</span><span class="hl-0">).</span><span class="hl-4">add</span><span class="hl-0">(</span><span class="hl-5">&quot;eagle&quot;</span><span class="hl-0">);</span><br/><span class="hl-1">// or alternatively</span><br/><span class="hl-7">set</span><span class="hl-0">.</span><span class="hl-4">addAll</span><span class="hl-0">(</span><span class="hl-5">&quot;aardvark&quot;</span><span class="hl-0">, </span><span class="hl-5">&quot;beaver&quot;</span><span class="hl-0">, </span><span class="hl-5">&quot;dog&quot;</span><span class="hl-0">, </span><span class="hl-5">&quot;fish&quot;</span><span class="hl-0">, </span><span class="hl-5">&quot;hamster&quot;</span><span class="hl-0">);</span><br/><span class="hl-7">set</span><span class="hl-0">.</span><span class="hl-4">has</span><span class="hl-0">(</span><span class="hl-5">&quot;cat&quot;</span><span class="hl-0">);</span><br/><span class="hl-1">// =&gt; true</span><br/><span class="hl-7">set</span><span class="hl-0">.</span><span class="hl-4">delete</span><span class="hl-0">(</span><span class="hl-5">&quot;cat&quot;</span><span class="hl-0">);</span><br/><span class="hl-1">// =&gt; true since &quot;cat&quot; was in the set</span><br/><span class="hl-7">set</span><span class="hl-0">.</span><span class="hl-4">has</span><span class="hl-0">(</span><span class="hl-5">&quot;cat&quot;</span><span class="hl-0">);</span><br/><span class="hl-1">// =&gt; false</span><br/><span class="hl-7">set</span><span class="hl-0">.</span><span class="hl-4">has</span><span class="hl-0">(</span><span class="hl-8">123.456</span><span class="hl-0">);</span><br/><span class="hl-1">// =&gt; false (any non-string returns false)</span>
</code></pre>
<p>Create a new string set from any <code>Iterable&lt;string&gt;</code>:</p>
<pre><code class="language-js"><span class="hl-1">// otherSet could be any Iterable&lt;string&gt;, such as a string array</span><br/><span class="hl-1">// or another TernaryStringSet</span><br/><span class="hl-2">let</span><span class="hl-0"> </span><span class="hl-7">otherSet</span><span class="hl-0"> = </span><span class="hl-2">new</span><span class="hl-0"> </span><span class="hl-9">Set</span><span class="hl-0">([</span><span class="hl-5">&quot;fish&quot;</span><span class="hl-0">, </span><span class="hl-5">&quot;hippo&quot;</span><span class="hl-0">]);</span><br/><span class="hl-2">let</span><span class="hl-0"> </span><span class="hl-7">set</span><span class="hl-0"> = </span><span class="hl-2">new</span><span class="hl-0"> </span><span class="hl-4">TernaryStringSet</span><span class="hl-0">(</span><span class="hl-7">otherSet</span><span class="hl-0">);</span><br/><span class="hl-7">set</span><span class="hl-0">.</span><span class="hl-4">has</span><span class="hl-0">(</span><span class="hl-5">&quot;hippo&quot;</span><span class="hl-0">);</span><br/><span class="hl-1">// =&gt; true</span>
</code></pre>
<p>Iterate over all elements in sorted order:</p>
<pre><code class="language-js"><span class="hl-6">for</span><span class="hl-0"> (</span><span class="hl-2">const</span><span class="hl-0"> </span><span class="hl-3">el</span><span class="hl-0"> </span><span class="hl-2">of</span><span class="hl-0"> </span><span class="hl-7">set</span><span class="hl-0">) {</span><br/><span class="hl-0">    </span><span class="hl-7">console</span><span class="hl-0">.</span><span class="hl-4">log</span><span class="hl-0">(</span><span class="hl-7">el</span><span class="hl-0">);</span><br/><span class="hl-0">}</span><br/><span class="hl-1">// or equivalently:</span><br/><span class="hl-7">set</span><span class="hl-0">.</span><span class="hl-4">forEach</span><span class="hl-0">((</span><span class="hl-7">el</span><span class="hl-0">) </span><span class="hl-2">=&gt;</span><span class="hl-0"> </span><span class="hl-7">console</span><span class="hl-0">.</span><span class="hl-4">log</span><span class="hl-0">(</span><span class="hl-7">el</span><span class="hl-0">));</span>
</code></pre>
<p>Get all elements that start with <code>&quot;sha&quot;</code>:</p>
<pre><code class="language-js"><span class="hl-7">set</span><span class="hl-0">.</span><span class="hl-4">getCompletionsOf</span><span class="hl-0">(</span><span class="hl-5">&quot;sha&quot;</span><span class="hl-0">);</span><br/><span class="hl-1">// =&gt; [&quot;shade&quot;, &quot;shadow&quot;, &quot;shake&quot;, &quot;shape&quot;, &quot;shapes&quot;] (for example)</span>
</code></pre>
<p>Get all elements that can be made from the letters of <code>&quot;taco&quot;</code>:</p>
<pre><code class="language-js"><span class="hl-7">set</span><span class="hl-0">.</span><span class="hl-4">getArrangementsOf</span><span class="hl-0">(</span><span class="hl-5">&quot;taco&quot;</span><span class="hl-0">);</span><br/><span class="hl-1">// =&gt; [&quot;act&quot;, &quot;cat&quot;, &quot;coat&quot;, &quot;taco&quot;] (for example)</span>
</code></pre>
<p>Get all elements within Hamming distance 1 of <code>&quot;cat&quot;</code>:</p>
<pre><code class="language-js"><span class="hl-7">set</span><span class="hl-0">.</span><span class="hl-4">getWithinHammingDistanceOf</span><span class="hl-0">(</span><span class="hl-5">&quot;cat&quot;</span><span class="hl-0">, </span><span class="hl-8">1</span><span class="hl-0">);</span><br/><span class="hl-1">// =&gt; [&quot;bat&quot;, &quot;can&quot;, &quot;cat&quot;, &quot;cot&quot;, &quot;sat&quot;] (for example)</span>
</code></pre>
<p>Get all elements within edit distance (Levenshtein distance) 1 of <code>&quot;cat&quot;</code>:</p>
<pre><code class="language-js"><span class="hl-7">set</span><span class="hl-0">.</span><span class="hl-4">getWithinEditDistanceOf</span><span class="hl-0">(</span><span class="hl-5">&quot;cat&quot;</span><span class="hl-0">, </span><span class="hl-8">1</span><span class="hl-0">);</span><br/><span class="hl-1">// =&gt; [&quot;at&quot;, &quot;bat&quot;, &quot;can&quot;, &quot;cat&quot;, &quot;cats&quot;, &quot;cot&quot;, &quot;sat&quot;] (for example)</span>
</code></pre>
<p>Get all elements that match <code>&quot;b.t&quot;</code>:</p>
<pre><code class="language-js"><span class="hl-7">set</span><span class="hl-0">.</span><span class="hl-4">getPartialMatchesOf</span><span class="hl-0">(</span><span class="hl-5">&quot;b.t&quot;</span><span class="hl-0">);</span><br/><span class="hl-1">// =&gt; [&quot;bat&quot;, &quot;bet&quot;, &quot;bit&quot;, &quot;bot&quot;, &quot;but&quot;] (for example)</span>
</code></pre>
<p>Create a new set with the elements reversed:</p>
<pre><code class="language-js"><span class="hl-7">set</span><span class="hl-0">.</span><span class="hl-4">map</span><span class="hl-0">((</span><span class="hl-7">el</span><span class="hl-0">) </span><span class="hl-2">=&gt;</span><span class="hl-0"> [...</span><span class="hl-7">el</span><span class="hl-0">].</span><span class="hl-4">reverse</span><span class="hl-0">().</span><span class="hl-4">join</span><span class="hl-0">(</span><span class="hl-5">&quot;&quot;</span><span class="hl-0">)).</span><span class="hl-4">toArray</span><span class="hl-0">();</span><br/><span class="hl-1">// =&gt; [&quot;olleH&quot;, &quot;rotcoD&quot;] (for example)</span>
</code></pre>
<p>Get the subset of 4-letter strings:</p>
<pre><code class="language-js"><span class="hl-7">set</span><span class="hl-0">.</span><span class="hl-4">filter</span><span class="hl-0">((</span><span class="hl-7">el</span><span class="hl-0">) </span><span class="hl-2">=&gt;</span><span class="hl-0"> </span><span class="hl-7">el</span><span class="hl-0">.</span><span class="hl-7">length</span><span class="hl-0"> === </span><span class="hl-8">4</span><span class="hl-0">).</span><span class="hl-4">toArray</span><span class="hl-0">();</span><br/><span class="hl-1">// =&gt; [&quot;bank&quot;, &quot;cave&quot;, &quot;door&quot;, &quot;four&quot;] (for example)</span>
</code></pre>
<p>List elements in reverse sorted order:</p>
<pre><code class="language-js"><span class="hl-7">set</span><span class="hl-0">.</span><span class="hl-4">reduce</span><span class="hl-0">((</span><span class="hl-7">acc</span><span class="hl-0">, </span><span class="hl-7">el</span><span class="hl-0">) </span><span class="hl-2">=&gt;</span><span class="hl-0"> </span><span class="hl-5">`</span><span class="hl-2">${</span><span class="hl-7">el</span><span class="hl-2">}</span><span class="hl-5">, </span><span class="hl-2">${</span><span class="hl-7">acc</span><span class="hl-2">}</span><span class="hl-5">`</span><span class="hl-0">);</span><br/><span class="hl-1">// =&gt; &quot;cherry, banana, apple&quot; (for example)</span>
</code></pre>
<p>Test if any element is longer than 9 characters:</p>
<pre><code class="language-js"><span class="hl-7">set</span><span class="hl-0">.</span><span class="hl-4">add</span><span class="hl-0">(</span><span class="hl-5">&quot;ambidextrous&quot;</span><span class="hl-0">).</span><span class="hl-4">some</span><span class="hl-0">((</span><span class="hl-7">el</span><span class="hl-0">) </span><span class="hl-2">=&gt;</span><span class="hl-0"> </span><span class="hl-7">el</span><span class="hl-0">.</span><span class="hl-7">length</span><span class="hl-0"> &gt; </span><span class="hl-8">9</span><span class="hl-0">);</span><br/><span class="hl-1">// =&gt; true</span>
</code></pre>
<p>Compare sets:</p>
<pre><code class="language-js"><span class="hl-2">let</span><span class="hl-0"> </span><span class="hl-7">s1</span><span class="hl-0"> = </span><span class="hl-2">new</span><span class="hl-0"> </span><span class="hl-4">TernaryStringSet</span><span class="hl-0">([</span><span class="hl-5">&quot;a&quot;</span><span class="hl-0">, </span><span class="hl-5">&quot;b&quot;</span><span class="hl-0">, </span><span class="hl-5">&quot;c&quot;</span><span class="hl-0">]);</span><br/><span class="hl-2">let</span><span class="hl-0"> </span><span class="hl-7">s2</span><span class="hl-0"> = </span><span class="hl-2">new</span><span class="hl-0"> </span><span class="hl-4">TernaryStringSet</span><span class="hl-0">(</span><span class="hl-7">s1</span><span class="hl-0">);</span><br/><span class="hl-7">s1</span><span class="hl-0">.</span><span class="hl-4">equals</span><span class="hl-0">(</span><span class="hl-7">s2</span><span class="hl-0">);</span><br/><span class="hl-1">// =&gt; true</span><br/><span class="hl-7">s1</span><span class="hl-0">.</span><span class="hl-4">isSubsetOf</span><span class="hl-0">(</span><span class="hl-7">s2</span><span class="hl-0">);</span><br/><span class="hl-1">// =&gt; true</span><br/><span class="hl-7">s2</span><span class="hl-0">.</span><span class="hl-4">add</span><span class="hl-0">(</span><span class="hl-5">&quot;d&quot;</span><span class="hl-0">);</span><br/><span class="hl-7">s1</span><span class="hl-0">.</span><span class="hl-4">equals</span><span class="hl-0">(</span><span class="hl-7">s2</span><span class="hl-0">);</span><br/><span class="hl-1">// =&gt; false</span><br/><span class="hl-7">s1</span><span class="hl-0">.</span><span class="hl-4">isSubsetOf</span><span class="hl-0">(</span><span class="hl-7">s2</span><span class="hl-0">);</span><br/><span class="hl-1">// =&gt; true</span><br/><span class="hl-7">s1</span><span class="hl-0">.</span><span class="hl-4">isSupersetOf</span><span class="hl-0">(</span><span class="hl-7">s2</span><span class="hl-0">);</span><br/><span class="hl-1">// =&gt; false</span>
</code></pre>
<p>Serialize to or from a buffer:</p>
<pre><code class="language-js"><span class="hl-1">// write a set to an ArrayBuffer</span><br/><span class="hl-2">const</span><span class="hl-0"> </span><span class="hl-3">buff</span><span class="hl-0"> = </span><span class="hl-7">set</span><span class="hl-0">.</span><span class="hl-4">toBuffer</span><span class="hl-0">();</span><br/><br/><span class="hl-1">// create a new set from a previously saved ArrayBuffer</span><br/><span class="hl-2">const</span><span class="hl-0"> </span><span class="hl-3">set</span><span class="hl-0"> = </span><span class="hl-7">TernaryStringSet</span><span class="hl-0">.</span><span class="hl-4">fromBuffer</span><span class="hl-0">(</span><span class="hl-7">buff</span><span class="hl-0">);</span>
</code></pre>
<p>Recreate a set from a buffer previously stored on a server:</p>
<pre><code class="language-js"><span class="hl-2">async</span><span class="hl-0"> </span><span class="hl-2">function</span><span class="hl-0"> </span><span class="hl-4">loadTernaryStringSet</span><span class="hl-0">(</span><span class="hl-7">url</span><span class="hl-0">) {</span><br/><span class="hl-0">  </span><span class="hl-2">const</span><span class="hl-0"> </span><span class="hl-3">response</span><span class="hl-0"> = </span><span class="hl-6">await</span><span class="hl-0"> </span><span class="hl-4">fetch</span><span class="hl-0">(</span><span class="hl-7">url</span><span class="hl-0">);</span><br/><span class="hl-0">  </span><span class="hl-6">if</span><span class="hl-0"> (!</span><span class="hl-7">response</span><span class="hl-0">.</span><span class="hl-7">ok</span><span class="hl-0">) {</span><br/><span class="hl-0">    </span><span class="hl-6">throw</span><span class="hl-0"> </span><span class="hl-2">new</span><span class="hl-0"> </span><span class="hl-9">Error</span><span class="hl-0">(</span><span class="hl-5">`set download &quot;</span><span class="hl-2">${</span><span class="hl-7">url</span><span class="hl-2">}</span><span class="hl-5">&quot; failed: </span><span class="hl-2">${</span><span class="hl-7">response</span><span class="hl-10">.</span><span class="hl-7">status</span><span class="hl-2">}</span><span class="hl-5"> </span><span class="hl-2">${</span><span class="hl-7">response</span><span class="hl-10">.</span><span class="hl-7">statusText</span><span class="hl-2">}</span><span class="hl-5">`</span><span class="hl-0">);</span><br/><span class="hl-0">  }</span><br/><span class="hl-0">  </span><span class="hl-2">const</span><span class="hl-0"> </span><span class="hl-3">buffer</span><span class="hl-0"> = </span><span class="hl-6">await</span><span class="hl-0"> </span><span class="hl-7">resonse</span><span class="hl-0">.</span><span class="hl-4">arrayBuffer</span><span class="hl-0">();</span><br/><span class="hl-0">  </span><span class="hl-6">return</span><span class="hl-0"> </span><span class="hl-7">TernaryStringSet</span><span class="hl-0">.</span><span class="hl-4">fromBuffer</span><span class="hl-0">(</span><span class="hl-7">buffer</span><span class="hl-0">);</span><br/><span class="hl-0">}</span>
</code></pre>
<p>A simple spelling checker:</p>
<pre><code class="language-js"><span class="hl-1">// make-dict.js</span><br/><span class="hl-1">// create dictionary set from a source list</span><br/><span class="hl-2">const</span><span class="hl-0"> </span><span class="hl-3">words</span><span class="hl-0"> = </span><span class="hl-7">fs</span><span class="hl-0">.</span><span class="hl-4">readFileSync</span><span class="hl-0">(</span><span class="hl-5">&quot;./wordlist.txt&quot;</span><span class="hl-0">, </span><span class="hl-5">&quot;utf8&quot;</span><span class="hl-0">).</span><span class="hl-4">split</span><span class="hl-0">(</span><span class="hl-5">&quot;</span><span class="hl-11">\n</span><span class="hl-5">&quot;</span><span class="hl-0">);</span><br/><span class="hl-2">const</span><span class="hl-0"> </span><span class="hl-3">dict</span><span class="hl-0"> = </span><span class="hl-2">new</span><span class="hl-0"> </span><span class="hl-4">TernaryStringSet</span><span class="hl-0">(</span><span class="hl-7">words</span><span class="hl-0">).</span><span class="hl-4">add</span><span class="hl-0">(</span><span class="hl-5">&quot;&quot;</span><span class="hl-0">);</span><br/><span class="hl-7">dict</span><span class="hl-0">.</span><span class="hl-4">balance</span><span class="hl-0">();</span><br/><span class="hl-7">dict</span><span class="hl-0">.</span><span class="hl-4">compact</span><span class="hl-0">();</span><br/><span class="hl-7">fs</span><span class="hl-0">.</span><span class="hl-4">writeFileSync</span><span class="hl-0">(</span><span class="hl-5">&quot;./dict.bin&quot;</span><span class="hl-0">, </span><span class="hl-7">dict</span><span class="hl-0">.</span><span class="hl-4">toBuffer</span><span class="hl-0">());</span><br/><br/><span class="hl-1">// check-spelling.js</span><br/><span class="hl-1">// load the dictionary created by make-dict.js</span><br/><span class="hl-2">const</span><span class="hl-0"> </span><span class="hl-3">dict</span><span class="hl-0"> = </span><span class="hl-7">TernaryStringSet</span><span class="hl-0">.</span><span class="hl-4">fromBuffer</span><span class="hl-0">(</span><span class="hl-7">fs</span><span class="hl-0">.</span><span class="hl-4">readFileSync</span><span class="hl-0">(</span><span class="hl-5">&quot;./dict.bin&quot;</span><span class="hl-0">));</span><br/><span class="hl-2">const</span><span class="hl-0"> </span><span class="hl-3">toCheck</span><span class="hl-0"> = </span><span class="hl-5">&quot;In a time long past lived a cat namd Captain Peanut.&quot;</span><br/><span class="hl-7">toCheck</span><span class="hl-0">.</span><span class="hl-4">toLowerCase</span><span class="hl-0">().</span><span class="hl-4">split</span><span class="hl-0">(</span><span class="hl-12">/\W</span><span class="hl-13">+</span><span class="hl-12">/</span><span class="hl-0">).</span><span class="hl-4">forEach</span><span class="hl-0">((</span><span class="hl-7">word</span><span class="hl-0">) </span><span class="hl-2">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-6">if</span><span class="hl-0"> (!</span><span class="hl-7">dict</span><span class="hl-0">.</span><span class="hl-4">has</span><span class="hl-0">(</span><span class="hl-7">word</span><span class="hl-0">)) {</span><br/><span class="hl-0">        </span><span class="hl-2">const</span><span class="hl-0"> </span><span class="hl-3">suggest</span><span class="hl-0"> = </span><span class="hl-7">dict</span><span class="hl-0">.</span><span class="hl-4">getWithinEditDistanceOf</span><span class="hl-0">(</span><span class="hl-7">word</span><span class="hl-0">, </span><span class="hl-8">1</span><span class="hl-0">);</span><br/><span class="hl-0">        </span><span class="hl-7">console</span><span class="hl-0">.</span><span class="hl-4">log</span><span class="hl-0">(</span><span class="hl-5">`misspelled:  </span><span class="hl-2">${</span><span class="hl-7">word</span><span class="hl-2">}</span><span class="hl-5">`</span><span class="hl-0">);</span><br/><span class="hl-0">        </span><span class="hl-7">console</span><span class="hl-0">.</span><span class="hl-4">log</span><span class="hl-0">(</span><span class="hl-5">`suggestions: </span><span class="hl-2">${</span><span class="hl-7">suggest</span><span class="hl-10">.</span><span class="hl-4">join</span><span class="hl-10">(</span><span class="hl-5">&quot;, &quot;</span><span class="hl-10">)</span><span class="hl-2">}</span><span class="hl-5">`</span><span class="hl-0">);</span><br/><span class="hl-0">    }</span><br/><span class="hl-0">});</span><br/><span class="hl-1">// =&gt; misspelled:  namd</span><br/><span class="hl-1">//    suggestions: name, named</span>
</code></pre>

<a href="#usage-notes" id="usage-notes" style="color: inherit; text-decoration: none;">
  <h2>Usage notes</h2>
</a>

<a href="#about-ternary-search-trees" id="about-ternary-search-trees" style="color: inherit; text-decoration: none;">
  <h3>About ternary search trees</h3>
</a>
<p>In a <em>ternary search tree</em> (TST), each node stores one letter and has three children: the &quot;less-than&quot;, &quot;equal-to&quot;, and &quot;greater-than&quot; branches.
To search for a string, you proceed letter-by-letter from the start of the target string.
If the node contains the letter you are currently looking for, you follow the &quot;equal-to&quot; branch and move to the next letter in the target string.
Otherwise, you follow the &quot;less-than&quot; or &quot;greater-than&quot; branch depending on whether the target letter comes before or after the node letter in lexicographic order, respectively.
For details, <a href="https://cgjennings.ca/articles/countdown-letters/">this article introduces them to solve a practical problem</a>, or you can refer to the <a href="https://en.wikipedia.org/wiki/Ternary_search_tree">Wikipedia entry</a>.</p>
<p>TSTs can be an excellent option for large string sets, especially if most or all strings are known ahead of time.
TSTs save space, as strings with a common prefix (that is, strings that start the same) share nodes in the tree.
In <em>this</em> TST implementation, strings with a common suffix can also share nodes.
Their superpower, however, is their facility for performing approximate and pattern-based matching.
For example, a TST is excellent for solving crossword puzzles.</p>

<a href="#differences-from-standard-js-set" id="differences-from-standard-js-set" style="color: inherit; text-decoration: none;">
  <h3>Differences from standard JS <code>Set</code></h3>
</a>
<p><code>TernaryStringSet</code>s behave like standard JS <code>Set</code>s, with minor differences:</p>
<ul>
<li>They iterate over their elements in sorted order (ascending lexicographic order by code point); <code>Sets</code> iterate over objects in the order they were added.</li>
<li>They support a superset of the standard <code>Set</code> interface, but are not a subclass of <code>Set</code>. Testing them with <code>instanceof Set</code> will return <code>false</code>.</li>
<li>They can contain the empty string, but cannot contain non-strings&mdash;not even <code>null</code> or <code>undefined</code>.</li>
<li>Methods that would return a new <code>Set</code>, such as <code>filter</code> or <code>union</code>, return a new <code>TernaryStringSet</code>.</li>
<li>Methods expect that <code>this</code> to be a <code>TernaryStringSet</code>; they should not be <code>call</code>ed with arbitrary objects.</li>
<li>The <code>addAll</code> method accepts either a list of string arguments (like <code>Set</code>s), or an <code>Iterable&lt;string&gt;</code> with an optional range.</li>
</ul>

<a href="#tree-health" id="tree-health" style="color: inherit; text-decoration: none;">
  <h3>Tree health</h3>
</a>
<p>Ternary search trees are not self-balancing&mdash;unlike, say, a red-black tree.
Adding strings in sorted order produces a worst-case tree structure.
This can be avoided by adding strings all at once using the constructor or <code>addAll</code>.
Given sorted input, both of these methods will produce an optimal tree structure.
If this is not practical, adding strings in random order will typically yield a tree that&#39;s &quot;close enough&quot; to balanced for most applications.
Calling <code>balance</code> will rebuild the tree in optimal form, but it can be expensive.</p>
<p>Since most <code>TernaryStringSet</code> methods are recursive, extremely unbalanced trees can provoke &quot;maximum call stack size exceeded&quot; errors.</p>

<a href="#code-point-ordering" id="code-point-ordering" style="color: inherit; text-decoration: none;">
  <h3>Code point ordering</h3>
</a>
<p>Sets are ordered and matched by their Unicode code point. For most strings this has no effect, but some Unicode code points span two characters (char codes) in a JavaScript string.
For example, the musical symbol 𝄞, code point U+1D11E, can be assigned to a JavaScript string as follows:</p>
<pre><code class="language-js"><span class="hl-2">const</span><span class="hl-0"> </span><span class="hl-3">clefG</span><span class="hl-0"> = </span><span class="hl-5">&quot;</span><span class="hl-11">\ud834\udd1e</span><span class="hl-5">&quot;</span><span class="hl-0">;</span>
</code></pre>
<p>Even though it represents a single symbol, the above string has a length of two.
To avoid surprises, <code>TernaryStringSet</code> matches by code point, not by char code.
For example, since the above string is one code point, it would match <code>getPartialMatchesOf(&quot;.&quot;)</code> and not <code>getPartialMatchesOf(&quot;..&quot;)</code>.</p>

<a href="#compaction" id="compaction" style="color: inherit; text-decoration: none;">
  <h3>Compaction</h3>
</a>
<p>Calling <code>compact</code> can significantly reduce a set&#39;s memory footprint.
For large sets of typical strings, this can reduce the set&#39;s footprint by more than 50%.
However, no strings can be added or deleted without first undoing the compaction (this is done automatically).
Compaction is relatively expensive, but can be a one-time or ahead-of-time step for many use cases.</p>

<a href="#serialization" id="serialization" style="color: inherit; text-decoration: none;">
  <h3>Serialization</h3>
</a>
<p>A common use case is to match user input against a fixed set of strings.
For example, checking input against a spelling dictionary or suggesting completions for partial input.
In such cases it is often desirable to build a set ahead of time, serialize it to a buffer, and then save the buffer data on a server to downloaded when needed.
Recreating a set directly from buffer data is generally much faster than downloading a file containing the strings and adding them to a new set on the client.</p>
<p>The following steps will make such ahead-of-time sets as small as possible:</p>
<ol>
<li>Create a set and insert the desired strings using <code>add</code> or <code>addAll</code>.</li>
<li>Minimize the tree size by calling <code>balance</code> followed by <code>compact</code>.</li>
<li>Create the buffer with <code>toBuffer</code> and write the result to a file.</li>
<li>Optionally, compress the result and configure the server to serve the compressed version where supported by the browser.</li>
</ol>
<p>To recreate the set, download or otherwise obtain the buffer data, then use <code>TernaryStringSet.fromBuffer(data)</code>.</p>

<a href="#developing" id="developing" style="color: inherit; text-decoration: none;">
  <h2>Developing</h2>
</a>
<p>Building from source requires Node.js.
Clone the repository, then install development dependencies:</p>
<pre><code class="language-bash"><span class="hl-0">npm install</span>
</code></pre>
<p>The TypeScript source is found under <code>src</code>.
Compiled output is written to <code>lib</code>. To build the project:</p>
<pre><code class="language-bash"><span class="hl-0">npm run build</span>
</code></pre>
<p>The included <code>tsconfig.json</code> targets ES2020.
To target old JavaScript engines or browsers you will need to modify this configuration and/or use a tool like Babel.</p>
<p>The project includes an extensive suite of tests under <code>src/tests</code>.
To run all tests:</p>
<pre><code class="language-bash"><span class="hl-0">npm </span><span class="hl-4">test</span>
</code></pre>
<p>HTML documentation can be prepared automatically using TypeDoc:</p>
<pre><code class="language-bash"><span class="hl-0">npm run doc</span>
</code></pre>
<p>Before submitting a pull request, format, lint, and run all tests:</p>
<pre><code class="language-bash"><span class="hl-0">npm run format &amp;&amp; npm run lint &amp;&amp; npm </span><span class="hl-4">test</span>
</code></pre>

<a href="#serialization-format" id="serialization-format" style="color: inherit; text-decoration: none;">
  <h2>Serialization format</h2>
</a>
<p>This section describes the binary format used to serialize a <code>TernaryStringSet</code>.
Serialized data consists of a stream of unsigned integers of 8, 16, 24, or 32 bits.
In the remaining sections, these are indicated by the notation int8, int32, and so on.
Integers wider than 1 byte are stored in
<a href="https://en.wikipedia.org/wiki/Endianness">big-endian order</a>.
For brevity, the serialized data is described as a &quot;file&quot;, but the data could come from any container or stream of bytes.</p>

<a href="#header" id="header" style="color: inherit; text-decoration: none;">
  <h3>Header</h3>
</a>
<p>The file begins with an 8 byte header consisting of:</p>
<p><strong>Magic (int16)</strong><br>A magic number identifying the file format.
This must be 0x5454 (<code>TT</code>) if the file is valid.</p>
<p><strong>Version (int8)</strong><br>Indicates the version of the format.
Valid values are currently 1, 2, or 3.
A value of 0 implies that the file is not valid.
Other values would indicate newer versions of the format.</p>
<p><strong>Tree flags (int8)</strong><br>A set of bit flags that denote specific features:</p>
<table>
<thead>
<tr>
<th align="right">Bits</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td align="right">0</td>
<td>Set if the set <em>contains the empty string</em>.</td>
</tr>
<tr>
<td align="right">1</td>
<td>Set if the tree nodes are <em>compact</em>, meaning that common suffixes share nodes.</td>
</tr>
<tr>
<td align="right">2</td>
<td>Only in version 2 files. Set if 16-bit branches were used.</td>
</tr>
<tr>
<td align="right">3–7</td>
<td>Reserved for future use.</td>
</tr>
</tbody></table>
<p><strong>Size (int32)</strong><br>The number of strings in the set, including the empty string if present.</p>

<a href="#tree-data" id="tree-data" style="color: inherit; text-decoration: none;">
  <h3>Tree data</h3>
</a>
<p>The remaining bytes encode the tree structure.
The format closely follows that used internally by <code>TernaryStringSet</code>s, which was already chosen for compactness.
This format consists of an array of integers, with each tree node represented by 4 integers in sequence: one for the code point and flags, and three for pointers (array offsets) to each of the less-than, equal-to, and greater-than branches, respectively.
The node starting at index 0 is the tree root.</p>
<p>The file format also follows this basic structure:
Elements of the original array are written out in order, but they may be represented by a variable number of bytes.
Before each node, a single byte is written whose bits describe how each of the node&#39;s four elements are encoded:</p>
<table>
<thead>
<tr>
<th align="right">Bits</th>
<th>Describe</th>
</tr>
</thead>
<tbody><tr>
<td align="right">6–7</td>
<td>how the code point and flags are encoded</td>
</tr>
<tr>
<td align="right">4–5</td>
<td>how the less-than branch is encoded</td>
</tr>
<tr>
<td align="right">2–3</td>
<td>how the equal-to branch is encoded</td>
</tr>
<tr>
<td align="right">0–1</td>
<td>how the greater-than branch is encoded</td>
</tr>
</tbody></table>
<p>Depending on the values of these fields, the node will require 1–16 bytes, including this encoding byte.</p>

<a href="#code-point-and-flags" id="code-point-and-flags" style="color: inherit; text-decoration: none;">
  <h4>Code point and flags</h4>
</a>
<p>Valid code points are up to 21 bits long.
In addition, a 22nd bit is used to indicate that the node terminates a string in the tree.
Depending on the magnitude of the code point, this data is written in 0–3 bytes as determined by bits 6–7 of the encoding byte:</p>
<table>
<thead>
<tr>
<th align="right">Bits</th>
<th>Code point</th>
<th>Written as</th>
</tr>
</thead>
<tbody><tr>
<td align="right">00</td>
<td>≥ 32768</td>
<td>int24</td>
</tr>
<tr>
<td align="right">01</td>
<td>128–32767</td>
<td>int16</td>
</tr>
<tr>
<td align="right">10</td>
<td>≤ 127</td>
<td>int8</td>
</tr>
<tr>
<td align="right">11</td>
<td>101 (<code>e</code>)</td>
<td>0 bytes</td>
</tr>
</tbody></table>
<p><strong>Encoding bits 00: code point ≥ 32768</strong><br>Large code points are written as an int24 value.
The lowest 21 bits store the code point.
The 22nd bit is set if the node terminates a string.
The highest two bits must be 0.</p>
<blockquote>
<p>For practical purposes, this can be treated as an int32 value in which the highest 8 bits are the node&#39;s encoding byte.</p>
</blockquote>
<p><strong>Encoding bits 01: code point in 128 to 32767</strong><br>Code points in this range are written as an int16 value.
The lowest 15 bits store the code point and the highest bit is set if the node terminates a string.</p>
<p><strong>Encoding bits 10: code point ≤ 127</strong><br>Small code points are written as a single int8 value.
The lowest 7 bits store the code point and the highest bit is set if the node terminates a string.</p>
<p><strong>Encoding bits 11: letter &quot;e&quot;</strong><br>As a special case, if the code point is exactly 0x65 (the letter &quot;e&quot;) <em>and</em> the node <em>does not</em> terminate a string, no bytes are written for the code point.</p>

<a href="#branch-pointers" id="branch-pointers" style="color: inherit; text-decoration: none;">
  <h4>Branch pointers</h4>
</a>
<p>In the <code>TernaryStringSet</code>, a branch pointer is either the special NUL value 0x7fffffff, or a smaller value that is an offset into the array at which the target node&#39;s data starts.
A NUL pointer is written in 0 bytes.
Otherwise the pointer is divided by 4 and then written as follows:</p>
<table>
<thead>
<tr>
<th align="right">Bits</th>
<th>Pointer/4</th>
<th>Written as</th>
</tr>
</thead>
<tbody><tr>
<td align="right">00</td>
<td>&gt; 0xffffff</td>
<td>int32</td>
</tr>
<tr>
<td align="right">01</td>
<td>&gt; 0xffff</td>
<td>int24</td>
</tr>
<tr>
<td align="right">10</td>
<td>≤ 0xffff</td>
<td>int16</td>
</tr>
<tr>
<td align="right">11</td>
<td>NUL pointer</td>
<td>0 bytes</td>
</tr>
</tbody></table>

<a href="#example" id="example" style="color: inherit; text-decoration: none;">
  <h4>Example</h4>
</a>
<p>Suppose the node to be written consists of the sequential elements <code>[0x41, 0x7fffffff, 0x42, 0x6789]</code>, meaning:</p>
<ul>
<li>The node&#39;s code point is 0x41 (the letter &quot;A&quot;), and since bit 21 is not set, this node does not terminate a string.</li>
<li>The node&#39;s less-than branch is NUL.</li>
<li>The node&#39;s equal-to branch points to offset 0x42.</li>
<li>The node&#39;s greater-than branch points to offset 0x6789.</li>
</ul>
<p> The following bytes would be written to the output file:</p>
<table>
<thead>
<tr>
<th align="right">Byte</th>
<th>Value</th>
<th>Explanation</th>
</tr>
</thead>
<tbody><tr>
<td align="right">0</td>
<td>0b10111010</td>
<td>Encoding field: int8 code point, NUL less-than, int16 equal-to and greater-than</td>
</tr>
<tr>
<td align="right">1</td>
<td>0x41</td>
<td>Code point for &quot;A&quot;, termination bit not set</td>
</tr>
<tr>
<td align="right">2</td>
<td>0x00</td>
<td>Equal-to branch high byte</td>
</tr>
<tr>
<td align="right">3</td>
<td>0x42</td>
<td>Equal-to branch low byte</td>
</tr>
<tr>
<td align="right">4</td>
<td>0x67</td>
<td>Greater-than branch high byte</td>
</tr>
<tr>
<td align="right">5</td>
<td>0x89</td>
<td>Greater-than branch low byte</td>
</tr>
</tbody></table>

<a href="#versions-1-and-2" id="versions-1-and-2" style="color: inherit; text-decoration: none;">
  <h2>Versions 1 and 2</h2>
</a>
<p>The current version of the file format is 3. Version 1 and 2 files differ in the following ways:</p>
<ol>
<li>In version 1 files, the header <code>size</code> field stores the number of nodes rather than the set size.
(The size can be calculated by iterating over the node data.)</li>
<li>The node data is written as a sequence of int32 values.
For each node, an int32 is written for each of the node value and three branch pointers.
Pointers are <em>not</em> divided by 4.</li>
<li>In version 2 files, the <em>16-bit branch</em> tree flag may be set.
In this case, <em>all</em> branch pointers are int16 values instead of int32 values; 0xffff indicates NUL.</li>
</ol>
</div></div><div class="col-4 col-menu menu-sticky-wrap menu-highlight"><nav class="tsd-navigation primary"><ul><li class="current"><a href="modules.html">Exports</a></li></ul></nav><nav class="tsd-navigation secondary menu-sticky"><ul><li class="tsd-kind-class"><a href="classes/TernaryStringSet.html" class="tsd-kind-icon">Ternary<wbr/>String<wbr/>Set</a></li><li class="tsd-kind-interface"><a href="interfaces/TernaryTreeStats.html" class="tsd-kind-icon">Ternary<wbr/>Tree<wbr/>Stats</a></li></ul></nav></div></div></div><footer class="with-border-bottom"><div class="container"><h2>Legend</h2><div class="tsd-legend-group"><ul class="tsd-legend"><li class="tsd-kind-property tsd-parent-kind-interface"><span class="tsd-kind-icon">Property</span></li><li class="tsd-kind-method tsd-parent-kind-interface"><span class="tsd-kind-icon">Method</span></li></ul><ul class="tsd-legend"><li class="tsd-kind-constructor tsd-parent-kind-class"><span class="tsd-kind-icon">Constructor</span></li><li class="tsd-kind-method tsd-parent-kind-class"><span class="tsd-kind-icon">Method</span></li></ul><ul class="tsd-legend"><li class="tsd-kind-method tsd-parent-kind-class tsd-is-static"><span class="tsd-kind-icon">Static method</span></li></ul></div><h2>Settings</h2><p>Theme <select id="theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></p></div></footer><div class="container tsd-generator"><p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></div><div class="overlay"></div><script src="assets/main.js"></script></body></html>